<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chat</title>

<body>
    当前userId：<span id="userId"></span><br />
    当前socketId: <span id="socketId"></span><br />
    输入框：<input id="input" type="text" />
    <button id="btn">发送</button>
    <script src="https://cdn.bootcss.com/socket.io/2.1.0/socket.io.js"></script>
    <script>
        window.onload = function () {
            const socket = io('http://localhost:7001/io', {
                query: {
                    // userId: `client_${Math.random()}`,
                },
                transports: ['websocket']
            });
            socket.on('connect', () => {
                const id = socket.id;
                console.log('#connect,', id, socket);
                socket.on(id, msg => {
                    console.log('#receive,', msg);
                });
            });
            // 接收在线用户信息
            socket.on('online', msg => {
                console.log('#online,', msg);
            });
            socket.on('disconnect', msg => {
                console.log('#disconnect', msg);
            });
            socket.on('disconnecting', () => {
                console.log('#disconnecting');
            });
            socket.on('error', () => {
                console.log('#error');
            });
            // socket.emit('msg', {
            //     target: 'message',
            //     msg: 'Dear server, this is huke requesting connection.',
            // });
            socket.on('auth', (res) => {
                console.log('auth successful>>', res)
            })
            window.socket = socket;
        };
    </script>
    <script>
        let userIdEle = document.getElementById('userId')
        userIdEle.innerHTML = localStorage.getItem('userId')

        let sendEle = document.getElementById('btn')
        let inputEle = document.getElementById('input')
        sendEle.addEventListener('click', () => {
            console.log(inputEle.value)
            let msg = inputEle.value
            socket.emit('msg', {
                target: 'message',
                msg
            })
        })

    </script>
</body>

</html>